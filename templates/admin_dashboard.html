{% extends "admin_base.html" %}

{% block content %}
{% if error %}
<div class="mb-4 admin-card border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">
    {{ error }}
</div>
{% endif %}

<div class="grid grid-cols-1 lg:grid-cols-3 gap-3 sm:gap-4">
    <div class="admin-card p-4 sm:p-5 lg:col-span-2">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
            <div>
                <p class="text-xs uppercase tracking-wider text-slate-500 font-semibold">Quick Chat</p>
                <p class="text-sm text-slate-600 mt-1">Post a message to the global chat (sender: <span class="font-semibold text-slate-900">Admin</span>)</p>
            </div>
            <a href="{{ url_for('admin_chat_panel') }}" class="admin-btn admin-btn-soft inline-flex items-center gap-2">
                <span class="iconify text-base text-indigo-600" data-icon="solar:chat-round-dots-outline"></span>
                Open Chat
            </a>
        </div>

        <form method="post" action="{{ url_for('chat_send') }}" enctype="multipart/form-data" class="mt-4 space-y-3" data-quick-form>
            <div class="flex items-stretch gap-2">
                <textarea
                    name="message"
                    rows="2"
                    class="admin-input flex-1 resize-none h-12 py-3 leading-5"
                    placeholder="Type a messageâ€¦"
                    required
                ></textarea>

                <label class="admin-btn admin-btn-soft cursor-pointer inline-flex items-center justify-center gap-2 shrink-0 h-12 w-12 sm:w-auto" title="Attach">
                    <span class="iconify text-base text-indigo-600" data-icon="solar:paperclip-2-linear"></span>
                    <span class="hidden sm:inline">Attach</span>
                    <input type="file" name="attachment" class="hidden" data-quick-attachment>
                </label>
                <button type="submit" class="admin-btn admin-btn-primary inline-flex items-center justify-center gap-2 shrink-0 h-12 w-12 sm:w-auto" title="Send">
                    <span class="iconify text-base text-white" data-icon="solar:arrow-right-outline"></span>
                    <span class="hidden sm:inline">Send</span>
                </button>
            </div>

            <p class="text-xs text-slate-500" data-quick-attachment-label></p>
        </form>
    </div>

    <div class="admin-card p-4 sm:p-5">
        <p class="text-xs uppercase tracking-wider text-slate-500 font-semibold">Group Chat</p>
        <p class="mt-2 text-2xl font-semibold text-slate-900">{{ chat_count if chat_count is defined else '' }}</p>
        <p class="text-sm text-slate-600">Message students and faculty in one room.</p>
        <div class="mt-4 flex flex-wrap gap-2">
            <a href="{{ url_for('admin_chat_panel') }}" class="admin-btn admin-btn-primary inline-flex items-center gap-2"><span class="iconify text-base" data-icon="solar:chat-round-dots-bold"></span> Open</a>
        </div>
    </div>

    <div class="admin-card p-4 sm:p-5">
        <p class="text-xs uppercase tracking-wider text-slate-500 font-semibold">Exam Forms</p>
        <p class="mt-2 text-2xl font-semibold text-slate-900">{{ open_forms }} <span class="text-sm font-medium text-slate-500">open</span></p>
        <div class="mt-4 flex flex-wrap gap-2">
            <a href="{{ url_for('admin_exam_forms') }}" class="admin-btn admin-btn-soft inline-flex items-center gap-2"><span class="iconify text-base text-indigo-600" data-icon="solar:settings-outline"></span> Manage</a>
            <a href="{{ url_for('admin_exam_form_new') }}" class="admin-btn admin-btn-primary inline-flex items-center gap-2"><span class="iconify text-base" data-icon="solar:add-square-bold"></span> New</a>
        </div>
    </div>

    <div class="admin-card p-4 sm:p-5">
        <p class="text-xs uppercase tracking-wider text-slate-500 font-semibold">Schedules</p>
        <p class="mt-2 text-sm text-slate-600">Manage events and weekly timetable</p>
        <a href="{{ url_for('admin_schedules') }}" class="mt-4 admin-btn admin-btn-soft inline-flex items-center gap-2"><span class="iconify text-base text-indigo-600" data-icon="solar:calendar-outline"></span> Open</a>
    </div>

    <div class="admin-card p-4 sm:p-5">
        <p class="text-xs uppercase tracking-wider text-slate-500 font-semibold">Teachers</p>
        <p class="mt-2 text-sm text-slate-600">Maintain faculty directory</p>
        <a href="{{ url_for('admin_teachers') }}" class="mt-4 admin-btn admin-btn-soft inline-flex items-center gap-2"><span class="iconify text-base text-indigo-600" data-icon="solar:users-group-rounded-outline"></span> Open</a>
    </div>

    <div class="admin-card p-4 sm:p-5">
        <p class="text-xs uppercase tracking-wider text-slate-500 font-semibold">Student Portal</p>
        <p class="mt-2 text-sm text-slate-600">Jump to student dashboard</p>
        <a href="{{ url_for('dashboard') }}" class="mt-4 admin-btn admin-btn-soft inline-flex items-center gap-2"><span class="iconify text-base text-indigo-600" data-icon="solar:home-2-outline"></span> Go</a>
    </div>

    <div class="admin-card p-4 sm:p-5">
        <p class="text-xs uppercase tracking-wider text-slate-500 font-semibold">Signed In As</p>
        <p class="mt-2 text-sm font-semibold text-slate-900">{{ admin_user.full_name if admin_user else 'Admin' }}</p>
        <p class="text-xs text-slate-500">Role: {{ admin_user.role if admin_user else '' }}</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    (function() {
        const attachment = document.querySelector('[data-quick-attachment]');
        const attachmentLabel = document.querySelector('[data-quick-attachment-label]');

        if (attachment && attachmentLabel) {
            attachment.addEventListener('change', () => {
                const f = attachment.files && attachment.files[0];
                attachmentLabel.textContent = f ? `Attachment: ${f.name}` : '';
            });
        }
    })();
</script>
{% endblock %}
